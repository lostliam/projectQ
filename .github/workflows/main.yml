name: 'test1'

on:
  workflow_dispatch:
  push:
    branches:
     - main
  schedule:
    - cron: '15 */8 * * 1'



jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal access token.
        fetch-depth: 0 # otherwise, there would be errors pushing refs to the destination repository.
    - name: Test    
      env:
        JD_COOKIE: ${{secrets.CK}}
      run: |
        sudo docker run -dit -v $PWD/ql/data:/ql/data -p 5700:5700 --name qinglong --hostname qinglong --restart unless-stopped whyour/qinglong:latest
        sudo docker exec qinglong bash -c "curl -fsSL https://ghproxy.com/https://raw.githubusercontent.com/FlechazoPh/QLDependency/main/Shell/QLOneKeyDependency.sh | sh" && docker exec qinglong bash -c 'ql repo https://github.com/6dylan6/jdpro.git "jd_|jx_|jddj_" "backUp" "^jd[^_]|USER|JD|function|sendNotify"' && docker exec -i qinglong bash -c "echo 'export JD_COOKIE=\"${JD_COOKIE}\"' >> /etc/profile && source /etc/profile && find /ql/data/scripts/6dylan6_jdpro/  -maxdepth 1 -type f -name '*.js' -exec node {} \;"
